version: 0.2
on:
  push:
    branches:
      - main
phases:
  install:
    runtime-versions:
      python: 3.8
    commands:
      - echo Installing dependencies...
      - pip install -r requirements.txt -t ./src
  build:
    commands:
      - echo Building the SAM package...
      - sam build
  deploy:
    commands:
      - echo Deploying the SAM template...
      - aws configure set aws_access_key_id $AWS_ACCESS_KEY_ID
      - aws configure set aws_secret_access_key $AWS_SECRET_ACCESS_KEY
      - sam deploy --stack-name coinmarketcap-api --region us-east-1 --no-confirm-changeset
