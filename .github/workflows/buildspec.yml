version: 0.2

phases:
  install:
    runtime-versions:
      python: 3.8
    commands:
      # Install AWS CLI
      curl "https://awscli.amazonaws.com/awscli-exe-linux-x86_64.zip" -o "awscliv2.zip"
      unzip awscliv2.zip
      sudo ./aws/install

  pre_build:
    commands:
      # Install dependencies
      pip install -r requirements.txt -t src/

  build:
    commands:
      # Package SAM application
      aws cloudformation package \
        --template-file template.yaml \
        --output-template-file packaged-template.yaml \
        --s3-bucket my-bucket

      # Deploy SAM application
      aws cloudformation deploy \
        --template-file packaged-template.yaml \
        --stack-name my-stack \
        --capabilities CAPABILITY_IAM

artifacts:
  type: zip
  files:
    - packaged-template.yaml
